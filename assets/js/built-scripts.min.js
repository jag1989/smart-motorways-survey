"use strict";$(function(){$("input").iCheck({checkboxClass:"icheckbox_square-blue",radioClass:"iradio_square-blue"}),$("#personal-country").select2({width:"100%"})});var API_KEY="AIzaSyDknQqpVHIrT35Q2sHRW9_GXpKL0Rq9d0o",PROJECT_ID="smartmotorwayssurvey",COLLECTION_NAME="Submissions",COLLECTION_NAME_EMAIL="Addresses";window.firebase.apikey=API_KEY,window.firebase.projectId=PROJECT_ID,window.firebase.collection=COLLECTION_NAME,window.firebase.collection_email=COLLECTION_NAME_EMAIL;var app=new Vue({el:"#survey-app",data:{db:null,dbCollection:window.firebase.collection,dbCollectionEmails:window.firebase.collection_email,dbApiKey:window.firebase.apikey,dbProjectId:window.firebase.projectId,inputsValid:!1,formWasSubmitted:!1,showPrimaryForm:!0,showNonUKMessage:!1,showSuccess:!1,isUKDriver:!0,isUKResident:!0,jsonSubmissionData:{},validLicense:null,residentUK:null,showEmailCapture:!0,submittingPrimary:!1,submittingSecondary:!1},computed:{showValidationErrorMessage:function(){return this.formWasSubmitted&&!this.inputsValid}},watch:{showValidationErrorMessage:function(changedTo){1==changedTo&&this.scrollErrorsIntoView()},showSuccess:function(changedTo){!0===changedTo&&(this.showPrimaryForm=!this.showPrimaryForm)},showNonUKMessage:function(changedTo){!0===changedTo&&(this.showPrimaryForm=!this.showPrimaryForm)},validLicense:function(changedTo){"no"==changedTo&&(this.showNonUKMessage=!0,this.isUKDriver=!1)},residentUK:function(changedTo){"no"==changedTo&&(this.showNonUKMessage=!0,this.isUKResident=!1)}},methods:{initDB:function(){var firebaseCredentials={apiKey:""+this.dbApiKey,authDomain:this.dbProjectId+".firebaseapp.com",projectId:""+this.dbProjectId};firebase.initializeApp(firebaseCredentials),this.db=firebase.firestore()},listSubmissions:function(){null!==this.db?this.db.collection(this.dbCollection).get().then(function(querySnapshot){querySnapshot.forEach(function(submission){console.log(submission.data())})}).catch(function(error){console.log("Error: "+error)}):console.log("No DB Connection")},addSubmission:function(dbCollectionName){var _this=this;null!==this.db?this.db.collection(dbCollectionName).add(this.jsonSubmissionData).then(function(submissionReference){!1===_this.showSuccess?(_this.showSuccess=!0,_this.submittingPrimary=!1):(_this.showEmailCapture=!1,_this.submittingSecondary=!1)}).catch(function(error){console.log("Error: "+error)}):console.log("No DB Connection")},addMainSubmission:function(){this.addSubmission(this.dbCollection)},addSecondarySubmission:function(){this.addSubmission(this.dbCollectionEmails)},buildSubmissionData:function(){this.jsonSubmissionData={submissionDate:this.getCurrentDate(),personal_1:this.getCurrentValueForRadioInput("personal-1"),personal_2:this.getCurrentValueForRadioInput("personal-2"),personal_3:this.getCurrentValueForSelect("personal-country"),personal_4:this.getCurrentValueForRadioInput("personal-4"),personal_5:this.getCurrentValueForRadioInput("personal-5"),personal_6:this.getCurrentValueForRadioInput("personal-6"),general_1:this.getCurrentValueForRadioInput("general-1"),general_2:this.getCurrentValueForRadioInput("general-2"),general_3:this.getCurrentValueForRadioInput("general-3"),general_4:this.getCurrentValuesForCheckbox("general-4"),general_5:this.getCurrentValueForRadioInput("general-5"),general_6:this.getCurrentValueForRadioInput("general-6"),detail_1:this.getCurrentValueForRadioInput("detail-1"),detail_2:this.getCurrentValueForRadioInput("detail-2"),detail_3:this.getCurrentValueForRadioInput("detail-3"),detail_4:this.getCurrentValueForRadioInput("detail-4"),detail_5:this.getCurrentValuesForCheckbox("detail-5"),detail_6:this.getCurrentValuesForCheckbox("detail-6"),detail_7:this.getCurrentValuesForCheckbox("detail-7"),detail_8:this.getCurrentValueForRadioInput("detail-8"),detail_9:this.getCurrentValuesForCheckbox("detail-9"),detail_10:this.getCurrentValueForRadioInput("detail-10"),detail_11:this.getCurrentValueForRadioInput("detail-11"),detail_12:this.getCurrentValueForRadioInput("detail-12"),comments:this.getCurrentValueForTextArea("additional-comments")}},buildSecondarySubmissionData:function(){this.jsonSubmissionData={email:this.getCurrentValueForTextInput("collection-email")}},onPrimarySubmission:function(){this.formWasSubmitted=!0,this.submittingPrimary=!0,this.buildSubmissionData(),this.validate()?this.addMainSubmission():!1===this.inputsValid&&!0===this.showValidationErrorMessage&&(this.submittingPrimary=!1,this.scrollErrorsIntoView())},onSecondarySubmission:function(){this.submittingSecondary=!0,this.buildSecondarySubmissionData(),this.addSecondarySubmission()},validate:function(){this.inputsValid=!0;for(var key in this.jsonSubmissionData)if(null==this.jsonSubmissionData[key]){this.inputsValid=!1;break}return this.inputsValid},getCurrentDate:function(){var today=new Date;return today.getDate()+"/"+(today.getMonth()+1)+"/"+today.getFullYear()},getCurrentValueForSelect:function(inputName){var selectElement=document.getElementById(inputName);return selectElement.options[selectElement.selectedIndex].value},getCurrentValueForRadioInput:function(inputName){return null!==document.querySelector('input[name="'+inputName+'"]:checked')?document.querySelector('input[name="'+inputName+'"]:checked').value:null},getCurrentValueForTextArea:function(inputName){return null!==document.getElementById(inputName).value?document.getElementById(inputName).value:""},getCurrentValueForTextInput:function(inputName){return null!==document.getElementById(inputName).value?document.getElementById(inputName).value:""},getCurrentValuesForCheckbox:function(groupName){var selectedCheckboxes=document.querySelectorAll('input[name="'+groupName+'"]:checked'),selectedValues=[];if(selectedCheckboxes.length>0)for(var i=0;i<selectedCheckboxes.length;i++)selectedValues.push(selectedCheckboxes[i].value);else selectedValues=null;return selectedValues},scrollErrorsIntoView:function(){Vue.nextTick().then(function(){document.getElementById("error-messages").scrollIntoView({behavior:"smooth"})})}},created:function(){$(function(){$('input[name="personal-1"]').on("ifChanged",function(event){app.$data.validLicense=$(this).val()}),$('input[name="personal-2"]').on("ifChanged",function(event){app.$data.residentUK=$(this).val()})}),this.initDB()}});